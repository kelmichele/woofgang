<% @page_title = "Our Locations" %>
<% @page_description = "New Description" %>


<div class="ipage-header">
	<div class="inside narrow">
		<h1><%= @page_title %></h1>
		<h2>Use the map below to find a location near you.</h2>
	</div>

	<% if user_signed_in? && current_user.admin? %>
  	<div class="boundary-align uk-panel">
	    <button class="woof-link wl-uk uk-float-right" type="button">Admin Options</button>
	    <div uk-dropdown="mode: click; pos: bottom-right; boundary: .wl-uk;">
      	<div class="admin-btns">
      		<div class="manu">
      			<%= link_to 'Add a Location', new_location_path, class: 'woof-link' %>
      			<%= link_to "Download CSV", locations_path(format: "csv"), class: 'woof-link dl' %>
      		</div>

    			<div class="import">
    				<p class="bmargin0">Import Locations</p>
    				<hr>
    				<%= form_tag import_locations_path, multipart: true do %>
    				  <%= file_field_tag :file %>
    				  <hr>
    				  <%= submit_tag "Import" %>
    				<% end %>
    			</div>
      	</div>
    	</div>
    </div>
	<% end %>
</div>


<div class="full-search">
	<!-- <div class="inside lg"> -->
	<div class="full listings">
		<div class="search-sec">
			<div class="inside lg">
				<div class="searcher">
					<%= form_with(url: locations_path, class: "form-inline", local: true, method: :get) do |f| %>
					  <%= f.text_field :near, class: "form-control", placeholder: "Search by Location" %>
					  <%= f.submit "", class: "btn btn-outline-secondary search" %>
					<% end %>
				</div>

		  	<div class="boundary-align uk-panel filter-box">
			    <div class="filter-uk">Search by Service <span  uk-icon="icon: chevron-down;"></span></div>
			    <div uk-dropdown="mode: click; pos: bottom-right; boundary: .filter-uk;">
			    	<% @tags.each do |tag| %>
							<div class="filter-tag">
								<span class="tag-icon <%= tag.name %>"></span>
								<%= link_to "#{tag.display_name}", tag_path(tag.name) %>
							</div>
						<% end %>
		    	</div>
		    </div>

		    <div class="text">
		    	<!-- <%= link_to "Move Map & click here to redo search within bounds", "#", id: "redo-search" %>  -->
		    	<%= link_to "#", id: "redo-search" do %>
		    		Refresh Search Within Map Bounds <span uk-icon="icon: refresh;"></span>
	    		<% end %>
		    </div>
		  </div>
		</div>

		<div class="map">
			<%= render 'shared/map' %>
		</div>

		<div class="loclist">
			<div class="inside">
				<table>
					<% @locations.each do |location| %>
						<div class="location-bx">
							<% if location.store_name %>
								<%= link_to location_path(location) do %>
									<div class="cat name"><%= location.ntitle.titleize %></div>
								<% end %>
							<% else %>
								<%= link_to location_path(location) do %>
									<div class="cat name">
										<!-- Woof Gang Bakery & Grooming  -->
										<%= location.city.titleize %></div>
								<% end %>
							<% end %>

							<div class="cat address">
								<%= location.street_address_one %><% if location.street_address_two %>,
								<span class="addr"><%= location.street_address_two.titleize %></span>
								<% end %>
								<br><%= location.city %>, <%= location.state %> <%= location.zip %>
							</div>

							<div class="cat phone"><a href="tel:<%= location.phone %>"><%= number_to_phone(location.phone, delimiter: '-') %></a></div>

							<div class="cat email">
								<a class="fw-mail" href="mailto:<%= location.email_address %>"><%= location.email_address %></a>
								<a class="sm-mail" href="mailto:<%= location.email_address %>"><span  uk-icon="icon: mail;"></span></a>
							</div>

							<% if location.tags.count > 0 %>
								<div class="cat tags">
									<span>Store Services:</span><br>
									<% location.tag_split.each do |tag| %>
										<button class="tag-icon <%= tag %>" uk-tooltip="<%= tag.titleize %>">
											<span class="tag-img"></span>
										</button>
									<% end %>
								</div>
							<% end %>

							<div class="btn-row">
								<%= link_to "Store Details", location_path(location), class: 'woof-link' %>
								<a href="<%= location.direct_link %>" target="_blank" class="woof-link dir">Directions </a>
							</div>


			    		<% if user_signed_in? && current_user.admin? %>
								<% if location.longitude == nil %><div class="actions">**<small>Coordinates Missing**</small></div><% end %>
							<% end %>
						</div>
					<% end %>
				</table>

				<%= will_paginate @locations, remote: true %>
			</div>
		</div>

	</div>
</div>


